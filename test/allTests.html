<!DOCTYPE html>
<html>

<head>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
	<script type="text/javascript" src="../js/jilParser.js"></script>
    <script type="text/javascript" src="../js/GraphBuilder.js"></script>

    <!-- QUnit -->
    <link rel="stylesheet" href="../jslib/qunit-1.12.0.css">
    <script src="../jslib/qunit-1.12.0.js"></script>
    <!-- QUnit -->

    <link rel="stylesheet" href="../css/jilGraph.css">

    <script type="text/javascript">
        "use strict";
        $(document).ready(function() {
            var jilParser = new JilParser();
            
            var testJil =
            [
              {
                "name": "job0_1",
                "job_type": "c",
                "command": 'start ""',
              },

              {
                "name": "box1",
                "job_type": "b",
              },
              {
                "name": "job1_1",
                "job_type": "c",
                "command": 'start ""',
                "box": "box1"
              },
              {
                "name": "job1_2",
                "job_type": "c",
                "command": 'start ""',
                "box": "box1",
                test: { a1: "aa", b1: "bb"}
              },
              
              {
                "name": "box2",
                "job_type": "b",
              },
              {
                "name": "job2_1",
                "job_type": "c",
                "box": "box2"
              },
            ];

            QUnit.test( "removeComments", function( assert ) {
                assert.equal( jilParser.removeComments($("#testJil1").text()), 
                    $("#removeCommentsResult").text().trim());
            });        

            QUnit.test( "parse", function( assert ) {
                var expected =
                [
                  {
                    "job_type": "b",
                    "name": "box1"
                  },
                  {
                    "command": 'start ""',
                    "job_type": "c",
                    "name": "job1_2"
                  }
                ];
                assert.deepEqual( jilParser.parse($("#testJil1").text()), 
                    expected);
            });
            
            var addJobTest = function( assert, jobType, divClass ) {
                var job = {name: "job1", job_type: jobType};
                
                var builder = new GraphBuilder();
                var div = builder.addJobDiv(job, $("#graphContainer1"));
                
                console.log(div);
                
                assert.equal(div.id, "div_" + job.name);
                assert.equal(div.className, divClass);
                assert.equal(div.innerText, job.name);
                assert.equal(div.parentElement.id, "graphContainer1");
            };
            
            QUnit.test("addJobDiv - job", function( assert ) {
                addJobTest(assert, "c", "job");
            });

            QUnit.test("addJobDiv - box", function( assert ) {
                addJobTest(assert, "b", "box");
            });

            QUnit.test("getBoxChildren - not a box", function( assert ) {
                var builder = new GraphBuilder(testJil);
                var jobArray = $.grep(testJil, function(job) { return job.name == "job1_1"; });
                assert.equal(jobArray.length, 1);
                assert.throws(function() { builder.getBoxChildren(jobArray[0]); }, 
                    "The provided object is not a box.");
            });
            
            QUnit.test("getBoxChildren", function( assert ) {
                var builder = new GraphBuilder(testJil);
                var jobArray = $.grep(testJil, function(job) { return job.name == "box1"; });
                var children = builder.getBoxChildren(jobArray[0]);
                assert.equal(children.length, 2);
                $.each(children, function(i, child) { 
                    assert.equal(child.name, "job1_" + (i+1));
                });
            });
            
            QUnit.test("build graph", function( assert ) {
                var builder = new GraphBuilder();
                builder.draw(testJil);
                
                //$(jil).each(function() { console.log(this); });
                expect(0);
            });
        });
    </script>

    <style type="text/css">
        code { white-space: pre; }
    </style>

</head>

<body>

    <div id="qunit"></div>
    <div id="qunit-fixture"></div>
    
    <code id="testJil1">
/* 
* Job 1
*/

insert_job: box1
job_type: b

/* Job 1_2 */

insert_job: job1_2 /* Another comment */
job_type: c
command: start "/* 'some'thing */"
    </code>
    <hr/>
    <code id="removeCommentsResult">
insert_job: box1
job_type: b



insert_job: job1_2 
job_type: c
command: start ""
    </code>
    <hr/>
    <code id="quoteValuesResult">
{
"box1": {
"job_type": "b",
},
"job1_2": {
"job_type": "c",
"command": "start \"\"",
}}
    </code>
    <hr/>
    <code id="test1">
{
"box1": {
"job_type": "b",
},
"job1_2": {
"job_type": "c",
"command": "start \"\"",
}}
    </code>
    <hr/>
    <code id="graphContainer1" />
	
</body>
</html> 
